(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{274:function(e,t,a){},457:function(e,t,a){"use strict";a.r(t);var c=a(2),n=(a(274),a(0)),s=a.n(n),i=a(54),r=a.n(i),l=a(44),o=a(11),u=a(130);a(278),a(458),a(459);try{u.a.initializeApp({apiKey:Object({NODE_ENV:"production",PUBLIC_URL:"/Chat-App-React%20",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_KEY,authDomain:Object({NODE_ENV:"production",PUBLIC_URL:"/Chat-App-React%20",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_AUTH_DOMAIN,projectId:Object({NODE_ENV:"production",PUBLIC_URL:"/Chat-App-React%20",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_PROJECT_ID,storageBucket:Object({NODE_ENV:"production",PUBLIC_URL:"/Chat-App-React%20",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_STORAGE_BUCKET,messagingSenderId:Object({NODE_ENV:"production",PUBLIC_URL:"/Chat-App-React%20",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_MESSAGING_SENDER_ID,appId:Object({NODE_ENV:"production",PUBLIC_URL:"/Chat-App-React%20",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_APP_ID})}catch(Q){/already exists/.test(Q.message)||console.error("Firebase admin initialization error",Q.stack)}var d={auth:u.a.auth(),storage:u.a.storage(),firestore:u.a.firestore()},j=a(33),h=Object(n.createContext)(),m=function(e){var t=e.children,a=e.authUser,s=Object(n.useState)(),i=Object(o.a)(s,2),r=i[0],u=i[1],m=Object(n.useState)(),b=Object(o.a)(m,2),O=b[0],f=b[1],v=Object(n.useState)(),p=Object(o.a)(v,2),g=p[0],C=p[1];return Object(n.useEffect)((function(){a&&d.firestore.collection("chatUsers").doc(a.uid).onSnapshot((function(e){f({userSecret:a.uid,avatar:e.data().avatar,userName:e.data().userName,projectID:"138ca56a-12fd-4b6b-9ed7-31a28d529351"})}))}),[a,f]),Object(c.jsx)(h.Provider,{value:{myChats:r,setMyChats:u,chatConfig:O,selectedChat:g,setChatConfig:f,setSelectedChat:C,selectChatClick:function(e){Object(j.f)(O,e.id,(function(t){C(Object(l.a)(Object(l.a)({},e),{},{messages:t}))}))},deleteChatClick:function(e){e.admin.username===O.userName&&window.confirm("Are you sure you want to delete this chat?")?Object(j.c)(O,e.id):window.confirm("Are you sure you want to leave this chat?")&&Object(j.i)(O,e.id,O.userName)},createChatClick:function(){Object(j.j)(O,{title:""})}},children:t})},b=function(){var e=Object(n.useContext)(h);return{myChats:e.myChats,setMyChats:e.setMyChats,chatConfig:e.chatConfig,selectedChat:e.selectedChat,setChatConfig:e.setChatConfig,setSelectedChat:e.setSelectedChat,selectChatClick:e.selectChatClick,deleteChatClick:e.deleteChatClick,createChatClick:e.createChatClick}},O=(a(318),function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var c=Object(n.useState)(!1),s=Object(o.a)(c,2),i=s[0],r=s[1];return Object(n.useEffect)((function(){r(t.every((function(e){return void 0!==e})))}),[t]),i}),f=a(17),v=function(){var e=Object(f.f)(),t=function(){var e=Object(n.useState)(),t=Object(o.a)(e,2),a=t[0],c=t[1];return Object(n.useEffect)((function(){return d.auth.onAuthStateChanged((function(e){c(e||null)}))}),[]),{authUser:a}}().authUser,a=O(t);return Object(n.useEffect)((function(){a&&e.push(t?"/":"/login")}),[a,t,e]),a?Object(c.jsx)(m,{authUser:t,children:Object(c.jsx)("div",{className:"app",children:Object(c.jsxs)(f.c,{children:[Object(c.jsx)(f.a,{path:"/",exact:!0,component:g}),Object(c.jsx)(f.a,{path:"/login",component:_}),Object(c.jsx)(f.a,{path:"/signup",component:T})]})})}):Object(c.jsx)(c.Fragment,{children:"Loading..."})},p=a(91),g=function(){var e=b(),t=e.myChats,a=e.setMyChats,s=e.chatConfig,i=e.selectedChat,r=e.selectChatClick,o=e.setSelectedChat;return Object(n.useEffect)((function(){console.log("My Chats: ",t)}),[t]),Object(n.useEffect)((function(){console.log("Selected Chat: ",i)}),[i]),Object(c.jsxs)(c.Fragment,{children:[!!s&&Object(c.jsx)(j.a,{hideUI:!0,userName:s.userName,projectID:s.projectID,userSecret:s.userSecret,onConnect:function(){Object(j.e)(s,a)},onNewChat:function(e){e.admin.username===s.userName&&r(e),a([].concat(Object(p.a)(t),[e]).sort((function(e,t){return e.id-t.id})))},onDeleteChat:function(e){(null===i||void 0===i?void 0:i.id)===e.id&&o(null),a(t.filter((function(t){return t.id!==e.id})).sort((function(e,t){return e.id-t.id})))},onNewMessage:function(e,c){i&&e===i.id&&o(Object(l.a)(Object(l.a)({},i),{},{messages:[].concat(Object(p.a)(i.messages),[c])}));var n=t.find((function(t){return t.id===e})),s=t.filter((function(t){return t.id!==e})),r=Object(l.a)(Object(l.a)({},n),{},{last_message:c});a([r].concat(Object(p.a)(s)).sort((function(e,t){return e.id-t.id})))}}),Object(c.jsxs)("div",{className:"chat-container",children:[Object(c.jsx)(W,{}),Object(c.jsx)("div",{className:"current-chat",children:i?Object(c.jsxs)("div",{className:"chat",children:[Object(c.jsx)(Y,{}),Object(c.jsx)(G,{}),Object(c.jsx)(K,{})]}):Object(c.jsxs)("div",{className:"no-chat-selected",children:[Object(c.jsx)("img",{src:"/img/pointLeft.png",className:"point-left",alt:"point-left"}),"Select A Chat"]})})]})]})},C=a(60),x=a(46),S={email:"",password:""},N=x.a().shape({email:x.c().required("Required"),password:x.c().required("Required")}),_=function(){var e=Object(f.f)(),t=Object(n.useState)(""),a=Object(o.a)(t,2),s=a[0],i=a[1];return Object(c.jsxs)("div",{className:"auth-form",children:[Object(c.jsx)("h1",{children:"Login"}),Object(c.jsx)(C.d,{onSubmit:function(e,t){var a=e.email,c=e.password,n=t.setSubmitting;d.auth.signInWithEmailAndPassword(a,c).then((function(e){e.user||i("We're having trouble loggin you in. Please try again")})).catch((function(e){"auth/wrong-password"===e.code?i("Invalid credentials"):"auth/user-not-found"===e.code?i("No account for this email"):i("Something went wrong :(")})).finally((function(){return n(!1)}))},validateOnMount:!0,initialValues:S,validationSchema:N,children:function(t){var a=t.isValid,n=t.isSubmitting;return Object(c.jsxs)(C.c,{children:[Object(c.jsx)(q,{name:"email",label:"Email",type:"email"}),Object(c.jsx)(q,{name:"password",label:"Password",type:"password"}),Object(c.jsxs)("div",{className:"auth-link-container",children:["Don't have an account?"," ",Object(c.jsx)("span",{className:"auth-link",onClick:function(){return e.push("signup")},children:"Sign Up!"})]}),Object(c.jsx)("button",{type:"submit",disabled:!a||n,children:"Login"})]})}}),!!s&&Object(c.jsx)("div",{className:"error",children:s})]})},E={email:"",password:"",userName:"",verifyPassword:""},y=x.a().shape({email:x.c().email("Invalid email address").required("Required"),password:x.c().required("Required").min(8,"Must be at least 8 characters"),verifyPassword:x.c().required("Required").oneOf([x.b("password"),null],"Passwords must match"),userName:x.c().required("Required").matches(/^\S*$/,"No spaces").min(3,"Must be at least 3 characters")}),T=function(){var e=Object(f.f)(),t=Object(n.useState)(" "),a=Object(o.a)(t,2),s=a[0],i=a[1];return Object(c.jsxs)("div",{className:"auth-form",children:[Object(c.jsx)("h1",{children:"Signup"}),Object(c.jsx)(C.d,{onSubmit:function(e,t){var a=e.email,c=e.userName,n=e.password,s=t.setSubmitting;d.auth.createUserWithEmailAndPassword(a,n).then((function(e){var t;(null===e||void 0===e||null===(t=e.user)||void 0===t?void 0:t.uid)?fetch("/api/createUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:c,userId:e.user.uid})}).then((function(){d.firestore.collection("chatUsers").doc(e.user.uid).set({userName:c,avatar:""})})):i("We're having trouble signing you up. Please try again.")})).catch((function(e){"auth/email-already-in-use"===e.code?i("An account with this email already exists"):i("We're having trouble signing you up. Please try again.")})).finally((function(){return s(!1)}))},validateOnMount:!0,initialValues:E,validationSchema:y,children:function(t){var a=t.isValid,n=t.isSubmitting;return Object(c.jsxs)(C.c,{children:[Object(c.jsx)(q,{name:"userName",label:"User Name"}),Object(c.jsx)(q,{name:"email",label:"Email",type:"email"}),Object(c.jsx)(q,{name:"password",label:"Password",type:"password"}),Object(c.jsx)(q,{name:"verifyPassword",label:"Verify Password",type:"password"}),Object(c.jsxs)("div",{className:"auth-link-container",children:["Already have an account?"," ",Object(c.jsx)("span",{className:"auth-link",onClick:function(){return e.push("login")},children:"Log In!"})]}),Object(c.jsx)("button",{disabled:n||!a,type:"submit",children:"Sign Up"})]})}}),!!s&&Object(c.jsx)("div",{className:"error",children:s})]})},w=a(114),R=function(e,t){var a,c;return null===(a=t.people.find((function(t){return t.person.username!==e.userName})))||void 0===a||null===(c=a.person)||void 0===c?void 0:c.username},A=function(e,t){return"@"+e.map((function(e){return e.person.username})).filter((function(e){return e!==t})).join(", @")},P=function(e){var t=[],a=[],c="";return e.forEach((function(e){e.sender.username!==c?(c&&t.push([].concat(a)),a.splice(0,a.length),a.push(e),c=e.sender.username):a.push(e)})),t.push([].concat(a)),t},k=function(){var e=b(),t=e.myChats,a=e.chatConfig,n=e.selectedChat,s=e.selectChatClick,i=e.deleteChatClick;return Object(c.jsx)("div",{className:"chat-list",children:t.map((function(e,t){return Object(c.jsxs)("div",{className:"chat-list-item ".concat((null===n||void 0===n?void 0:n.id)===e.id?"selected-chat-item":""),children:[Object(c.jsx)("div",{onClick:function(){return s(e)},className:"chat-list-item-content",children:1===e.people.length?Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(w.a,{circular:!0,inverted:!0,color:"red",name:"user cancel"}),Object(c.jsx)("div",{className:"chat-list-preview",children:Object(c.jsx)("div",{className:"preview-username",children:"No One Added Yet"})})]}):2===e.people.length?Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(L,{username:R(a,e),chat:e}),Object(c.jsxs)("div",{className:"chat-list-preview",children:[Object(c.jsx)("div",{className:"preview-username",children:R(a,e)}),Object(c.jsx)("div",{className:"preview-message",children:e.last_message.attachments.length?"".concat(e.last_message.sender.username," sent an attachment"):e.last_message.text.slice(0,50)+"..."})]})]}):Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(w.a,{circular:!0,inverted:!0,color:"blue",name:"users"}),Object(c.jsxs)("div",{className:"chat-list-preview",children:[Object(c.jsx)("div",{className:"preview-username",children:A(e.people,a.userName).slice(0,50)+"..."}),Object(c.jsx)("div",{className:"preview-message",children:e.last_message.attachments.length?"".concat(e.last_message.sender.username," sent an attachment"):e.last_message.text.slice(0,50)+"..."})]})]})}),Object(c.jsx)("div",{onClick:function(){return i(e)},className:"chat-item-delete",children:Object(c.jsx)(w.a,{name:"delete"})})]},t)}))})},D=a(472),U=a(260),I=a(262),F=function(){var e=b().chatConfig,t=O(e),a=Object(n.useRef)(null),s=Object(n.useState)(),i=Object(o.a)(s,2),r=i[0],l=i[1];return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("input",{type:"file",ref:a,className:"file-input",accept:"image/jpeg,image/png",onChange:function(e){var t,a,c=null===(t=e.target)||void 0===t||null===(a=t.files)||void 0===a?void 0:a[0];c&&function(e){l(e)}(c)}}),!!r&&Object(c.jsx)(J,{crop:!0,file:r,header:"Set Your Avatar",mode:"message",onSubmit:function(t){var a=d.storage.ref().child("".concat(e.userSecret,"_avatar.jpg"));a.put(t).then((function(){a.getDownloadURL().then((function(t){d.firestore.collection("chatUsers").doc(e.userSecret).update({avatar:t}).then((function(){l(null)}))}))}))},close:function(){return l(null)}}),Object(c.jsxs)("div",{className:"left-rail-header",children:[Object(c.jsx)(w.a,{onClick:function(){return d.auth.signOut()},className:"sign-out",name:"sign out"}),t&&e?Object(c.jsxs)("div",{className:"current-user-info",children:[Object(c.jsxs)(U.a,{onClick:function(){var e=a.current;e&&(e.value="",e.click())},className:"user-avatar",size:"large",children:[e.avatar?Object(c.jsx)(I.a,{src:e.avatar,avatar:!0}):Object(c.jsx)("div",{className:"empty-avatar",children:e.userName[0].toUpperCase()}),Object(c.jsx)(w.a,{corner:!0,name:"camera",inverted:!0,circular:!0})]}),Object(c.jsx)("div",{className:"current-username",children:e.userName})]}):Object(c.jsx)("div",{className:"user-loading",children:Object(c.jsx)(D.a,{active:!0,size:"small"})})]})]})},W=function(){var e=b(),t=e.myChats,a=e.createChatClick,n=O(t);return Object(c.jsxs)("div",{className:"left-rail",children:[Object(c.jsx)(F,{}),n?Object(c.jsxs)(c.Fragment,{children:[t.length?Object(c.jsx)("div",{className:"chat-list-container",children:Object(c.jsx)(k,{})}):Object(c.jsx)("div",{className:"chat-list-container no-chats-yet",children:Object(c.jsx)("h3",{children:"No Chats Yet"})}),Object(c.jsx)("button",{className:"create-chat-button",onClick:a,children:"Create Chat"})]}):Object(c.jsx)("div",{className:"chats-loading",children:Object(c.jsx)(D.a,{active:!0,size:"huge"})})]})},K=function(){var e=b(),t=e.chatConfig,a=e.selectedChat,s=Object(n.useState)(""),i=Object(o.a)(s,2),r=i[0],l=i[1],u=Object(n.useState)(!1),d=Object(o.a)(u,2),h=d[0],m=d[1],O=Object(n.useRef)(null),f=Object(n.useState)(),v=Object(o.a)(f,2),p=v[0],g=v[1],C=function(){a&&r&&(l(""),Object(j.l)(t,a.id,{text:r,files:[]}))};return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsxs)("div",{className:"chat-controls",children:[Object(c.jsx)("div",{onClick:function(){var e=O.current;e&&(e.value="",e.click())},className:"attachment-icon",children:Object(c.jsx)(w.a,{name:"attach",color:"white"})}),Object(c.jsx)("input",{value:r,className:"chat-input",placeholder:"Send a message",onKeyPress:function(e){"Enter"===e.key&&C()},onChange:function(e){return l(e.target.value)}}),Object(c.jsx)("div",{onClick:C,className:"send-message-icon",children:Object(c.jsx)(w.a,{name:"send",color:"grey"})})]}),Object(c.jsx)("input",{type:"file",ref:O,className:"file-input",accept:"image/jpeg,image/png",onChange:function(e){var t,a,c=null===(t=e.target)||void 0===t||null===(a=t.files)||void 0===a?void 0:a[0];c&&function(e){g(e),m(!0)}(c)}}),!!h&&!!p&&Object(c.jsx)(J,{file:p,onSubmit:function(){Object(j.l)(t,a.id,{text:r,files:[p]},(function(){g(null),l("")}))},close:function(){return m(!1)}})]})},L=function(e){var t=e.chat,a=e.username,s=e.className,i=b().chatConfig,r=Object(n.useState)(""),l=Object(o.a)(r,2),u=l[0],j=l[1];return Object(n.useEffect)((function(){d.firestore.collection("chatUsers").where("userName","==",a).get().then((function(e){var t,a=null===(t=e.docs[0])||void 0===t?void 0:t.data();(null===a||void 0===a?void 0:a.avatar)&&j(a.avatar)}))}),[t,i,a]),u?Object(c.jsx)(I.a,{className:s||"chat-list-avatar",src:u}):Object(c.jsx)("div",{className:s||"empty-avatar",children:a[0].toUpperCase()})},H=a(473),M=(a(323),function(e){var t=e.visible,a=e.closeFn,s=Object(n.useRef)(),i=Object(n.useState)(),r=Object(o.a)(i,2),u=r[0],d=r[1],h=Object(n.useState)(),m=Object(o.a)(h,2),O=m[0],f=m[1],v=function(e,t){var a=Object(n.useState)(e),c=Object(o.a)(a,2),s=c[0],i=c[1];return Object(n.useEffect)((function(){var a=setTimeout((function(){return i(e)}),t);return function(){return clearTimeout(a)}}),[e,t]),s}(O,500),g=Object(n.useState)(null),C=Object(o.a)(g,2),x=C[0],S=C[1];Object(n.useEffect)((function(){t&&s&&s.focus()}),[t]);var N=b(),_=N.myChats,E=N.setMyChats,y=N.chatConfig,T=N.selectedChat,w=N.setSelectedChat;return Object(n.useEffect)((function(){v?(d(!0),Object(j.g)(y,T.id,(function(e,t){var a=Object.keys(t).map((function(e){return t[e].username})).filter((function(e){return e.toLowerCase().includes(v.toLowerCase())}));S(a.map((function(e){return{title:e}}))),d(!1)}))):S(null)}),[y,T,v]),Object(c.jsx)("div",{className:"user-search",style:{display:t?"block":"none"},children:Object(c.jsx)(H.a,{fluid:!0,onBlur:a,loading:u,value:O,results:x,placeholder:"Search For Users",open:!!x&&!u,input:{ref:function(e){return s=e}},onSearchChange:function(e){return f(e.target.value)},onResultSelect:function(e,t){var c,n;(null===(c=t.result)||void 0===c?void 0:c.title)&&(n=t.result.title,Object(j.b)(y,T.id,n,(function(){var e=_.filter((function(e){return e.id!==T.id})),t=Object(l.a)(Object(l.a)({},T),{},{people:[].concat(Object(p.a)(T.people),[{person:{username:n}}])});w(t),E([].concat(Object(p.a)(e),[t])),a()})))}})})}),q=function(e){var t=e.name,a=e.label,n=e.type,s=void 0===n?"text ":n;return Object(c.jsxs)("label",{children:[a,Object(c.jsx)(C.b,{type:s,name:t}),Object(c.jsx)(C.a,{className:"error",component:"div",name:t})]})},B=a(261),V=a.n(B),z=a(474),J=(a(326),function(e){var t=e.file,a=e.close,s=e.onSubmit,i=e.crop,r=void 0!==i&&i,l=e.header,u=void 0===l?"Send This Image?":l,d=Object(n.useState)(""),j=Object(o.a)(d,2),h=j[0],m=j[1],b=Object(n.useRef)();return Object(n.useEffect)((function(){var e=new FileReader;e.onload=function(){return m(e.result)},e.readAsDataURL(t)}),[t]),Object(c.jsxs)(z.a,{dimmer:"blurring",open:!0,children:[Object(c.jsx)(z.a.Header,{children:u}),Object(c.jsx)(z.a.Content,{image:!0,children:r?Object(c.jsx)(V.a,{ref:b,width:200,height:200,border:50,image:h}):Object(c.jsx)(I.a,{size:"medium",src:h,alt:"preview"})}),Object(c.jsx)(z.a.Actions,{children:Object(c.jsxs)("div",{className:"image-upload-actions",children:[Object(c.jsx)("button",{className:"cancel",onClick:a,children:"Cancel"}),Object(c.jsx)("button",{className:"submit",onClick:function(){if(r&&b){var e=b.current.getImageScaledToCanvas().toDataURL();fetch(e).then((function(e){return e.blob()})).then((function(e){return s(e)}))}else s()},children:"Upload"})]})})]})}),Y=function(){var e=b(),t=e.selectedChat,a=e.chatConfig,s=Object(n.useState)(!1),i=Object(o.a)(s,2),r=i[0],l=i[1];return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsxs)("div",{className:"chat-toolbar",children:[Object(c.jsx)("div",{className:"chat-header-text",children:A(t.people,a.userName).slice(0,100)}),Object(c.jsx)("div",{className:"add-user-icon",children:Object(c.jsx)(w.a,{color:"white",name:"user plus",onClick:function(){return l(!0)}})})]}),Object(c.jsx)(M,{visible:r,cloaeFn:function(){return l(!1)}})]})},G=function(){var e,t,a=b().selectedChat;return e=a,t="chat-messages",Object(n.useEffect)((function(){e&&Promise.all(Array.from(document.images).filter((function(e){return!e.complete})).map((function(e){return new Promise((function(t){e.onload=e.onerror=t}))}))).then((function(){document.getElementsByClassName(t)[0].scrollTop=document.getElementsByClassName(t)[0].scrollHeight}))}),[e,t]),Object(c.jsx)("div",{className:"chat-messages",children:a.messages.length?P(a.messages).map((function(e,t){return Object(c.jsxs)("div",{className:"chat-message",children:[Object(c.jsxs)("div",{className:"chat-message-header",children:[Object(c.jsx)(L,{className:"message-avatar",username:e[0].sender.username,chat:a}),Object(c.jsx)("div",{className:"message-author",children:e[0].sender.username})]}),Object(c.jsx)("div",{className:"message-content",children:e.map((function(e,t){return Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{className:"message-text",children:e.text}),!!e.attachments.length&&Object(c.jsx)("img",{className:"message-image",src:e.attachments[0].file,alt:e.id+"-attachment"})]},t)}))})]},t)})):Object(c.jsx)("div",{className:"no-messages-yet",children:"No messages yet"})})},$=a(147);r.a.render(Object(c.jsx)(s.a.StrictMode,{children:Object(c.jsx)($.a,{children:Object(c.jsx)(v,{})})}),document.getElementById("root"))}},[[457,1,2]]]);
//# sourceMappingURL=main.2c785135.chunk.js.map